<html lang="zxx">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" type="image/png" href="../../assets/img/favicon.png">

  <!-- Bootstrap CSS (make sure it's included) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body>
  <app-sidebar-admin></app-sidebar-admin>
  <div class="main-content d-flex flex-column">
    <app-navbar-admin></app-navbar-admin>

    <br><br>

    <div class="container mt-4 px-2 px-sm-4">
      <h2 class="text-center">Gestion des Sociétés</h2>

      <div class="d-flex justify-content-center" *ngIf="loading">
        <div class="spinner-border" role="status">
          <span class="sr-only">Loading...</span>
        </div>
      </div>

      <div class="table-responsive mt-4">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Nom</th>
              <th>Email</th>
              <th class="d-none d-sm-table-cell">Date Inscription</th>
              <th class="d-none d-md-table-cell">Statut du compte</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let company of companies">
              <td>{{ company.name }}</td>
              <td>
                {{ company.email }}
                <span class="badge bg-info text-white ms-2" *ngIf="isNew(company.date_inscription)">Nouveau</span>
              </td>
              <td class="d-none d-sm-table-cell">
                {{ company.date_inscription | date: 'dd MMM yyyy' }}
              </td>
              <td class="d-none d-md-table-cell">
                <i class="bx bx-x-circle text-danger" *ngIf="!company.enabled"></i>
                <i class="bx bx-check-circle text-success" *ngIf="company.enabled"></i>
                {{ company.enabled ? 'Actif' : 'Désactivé' }}
                <div class="spinner-border" role="status" style="width: 10px; height: 10px" *ngIf="company.uid == selectedUser">
                  <span class="sr-only">Loading...</span>
                </div>
              </td>
              <td>
                <div class="d-flex flex-column flex-md-row align-items-start gap-1">
                  <div class="form-check form-switch">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      role="switch"
                      id="company-{{ company.uid }}"
                      [checked]="company?.enabled"
                      (change)="toggleAccountEnabled(company, $event)"
                    >
                  </div>
                  <button class="btn btn-primary btn-sm" (click)="downloadFile(company)">
                    <i class="bx bxs-download"></i>
                  </button>
                  <button class="btn btn-secondary btn-sm" (click)="previewFile(company)">
                    <i class="bi bi-eye"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>

</html>
